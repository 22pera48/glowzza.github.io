<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Clientes</title>
</head>
<body>
  <h2>Registrar Cliente</h2>
  <form id="clienteForm">
    <input type="text" id="nombre" placeholder="Nombre" required>
    <input type="date" id="fecha" required>
    <button type="submit">Guardar</button>
        <button onclick="location.href='menu.html'">Volver al Menú Principal</button>

  </form>

  <div style="display:flex; gap:40px; margin-top:20px;">
    <div>
<h2>Lista de Clientes</h2>
<input type="text" id="buscadorClientes" placeholder="Buscar cliente por nombre o ID">
<ul id="listaClientes">
  <!-- Aquí se cargan los clientes -->
</ul>
    </div>
    <div>
<h2>Lista de Ventas Cerradas</h2>
<input type="text" id="buscadorVentas" placeholder="Buscar venta cerrada por nombre o etiqueta">
<ul id="listaVentasCerradas">
  <!-- Aquí se cargan las ventas cerradas -->
</ul>
    </div>
  </div>

  <!-- Script de Firebase -->
  <script type="module" src="firebase.js"></script>
<script>
  // Buscador de clientes
  const buscadorClientes = document.getElementById("buscadorClientes");
  const listaClientes = document.getElementById("listaClientes");

  buscadorClientes.addEventListener("input", () => {
    const filtro = buscadorClientes.value.toLowerCase();
    const clientes = listaClientes.querySelectorAll("li");

    clientes.forEach(cliente => {
      const texto = cliente.textContent.toLowerCase();
      cliente.style.display = texto.includes(filtro) ? "" : "none";
    });
  });

  // Buscador de ventas cerradas
  const buscadorVentas = document.getElementById("buscadorVentas");
  const listaVentas = document.getElementById("listaVentasCerradas");

  buscadorVentas.addEventListener("input", () => {
    const filtro = buscadorVentas.value.toLowerCase();
    const ventas = listaVentas.querySelectorAll("li");

    ventas.forEach(venta => {
      const texto = venta.textContent.toLowerCase();
      venta.style.display = texto.includes(filtro) ? "" : "none";
    });
  });
</script>
<!-- Script de Firebase -->
<script type="module">
  import { getDocs, collection, deleteDoc, doc } from "firebase/firestore";
  import { db } from "./firebase.js";

  // Cargar clientes
  async function cargarClientes() {
    const querySnapshot = await getDocs(collection(db, "clientes"));
    querySnapshot.forEach(docSnap => {
      const cliente = docSnap.data();

      const li = document.createElement("li");
      li.textContent = `${cliente.etiqueta} - ${cliente.nombre}`;

      // Botón de eliminar automático
      const btnEliminar = document.createElement("button");
      btnEliminar.textContent = "Eliminar";
      btnEliminar.onclick = () => eliminarCliente(docSnap.id);

      li.appendChild(btnEliminar);
      document.getElementById("listaClientes").appendChild(li);
    });
  }

  cargarClientes();

  // Función de eliminar con contraseña
  function eliminarCliente(idCliente) {
    const clave = prompt("Ingrese la contraseña para eliminar:");
    if (clave === "admin123") {
      deleteDoc(doc(db, "clientes", idCliente))
        .then(() => alert("Cliente eliminado correctamente"))
        .catch(err => console.error("Error al eliminar:", err));
    } else {
      alert("Contraseña incorrecta. No se eliminó nada.");
    }
  }
</script>
</body>
</html>